<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jig.mapper.JigMapper">
    <select id="searchJigDefinition" resultType="com.jig.entity.JigDefinition">
        SELECT jd.*, jf.family, workcell.workcell
        FROM jig_definition jd,
        jig_family jf,
        workcell
        WHERE jd.family_id = jf.id
        and jd.workcell_id = workcell.id
        <if test="code != null">
            and code like concat('%',#{code},'%')
        </if>
        <if test="name != null">
            and name like concat('%',#{name},'%')
        </if>
        <if test="workcell != null">
            and workcell like concat('%',#{workcell},'%')
        </if>
        <if test="family != null">
            and family like concat('%',#{family},'%')
        </if>
        <if test="user_for != null">
            and user_for like concat('%',#{user_for},'%')
        </if>
        limit #{page_number},5
    </select>
    <select id="searchJigDefinitionPage" resultType="java.lang.Integer">
        SELECT count(*)
        FROM jig_definition jd,
        jig_family jf,
        workcell
        WHERE jd.family_id = jf.id
        and jd.workcell_id = workcell.id
        <if test="code != null">
            and code like concat('%',#{code},'%')
        </if>
        <if test="name != null">
            and name like concat('%',#{name},'%')
        </if>
        <if test="workcell != null">
            and workcell like concat('%',#{workcell},'%')
        </if>
        <if test="family != null">
            and family like concat('%',#{family},'%')
        </if>
        <if test="user_for != null">
            and user_for like concat('%',#{user_for},'%')
        </if>
    </select>
    <select id="getSimpleJigDefinition" resultType="com.jig.entity.JigDefinition">
        SELECT jd.*,
               w.workcell,
               name1.name owner_name,
               name2.name rec_by_name,
               name3.name edit_by_name
        FROM jig_definition jd,
             workcell w,
             (SELECT `user`.`name`
              FROM `user`,
                   jig_definition
              WHERE `user`.id = jig_definition.`owner`
                and jig_definition.id = #{id}) name1,
             (SELECT `user`.`name`
              FROM `user`,
                   jig_definition
              WHERE `user`.id = jig_definition.rec_by
                and jig_definition.id = #{id}
             ) name2,
             (SELECT `user`.`name`
              FROM `user`,
                   jig_definition
              WHERE `user`.id = jig_definition.edit_by
                and jig_definition.id = #{id}) name3
        WHERE jd.id = #{id}
          AND w.id = jd.workcell_id
    </select>
</mapper>