<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>demo</title>
    <script src="js/jquery-3.4.1.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/vue.js"></script>
    <script src="https://cdn.staticfile.org/axios/0.18.0/axios.min.js"></script>
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <script th:inline="javascript">
        $(function () {
            //为页码添加点击事件
            $("#list li").click(function (e) {
                console.log(e)
                const now = parseInt($("#list li.active").text());
                console.log(now)
                if ($(this).text() === '«') {
                    if (now > 1) {
                        demoVue.$data.now_page_number = now - 1;
                        $.ajax({
                            url: 'get_demo_list',
                            data: {
                                page_number: demoVue.$data.now_page_number
                            },
                            success: function (res) {
                                demoVue.$data.stu = res.data;
                            }
                        })
                    }
                } else if ($(this).text() === '»') {
                    if (now < demoVue.$data.max_page_number) {
                        demoVue.$data.now_page_number = now + 1;
                        $.ajax({
                            url: 'get_demo_list',
                            data: {
                                page_number: demoVue.$data.now_page_number
                            },
                            success: function (res) {
                                demoVue.$data.stu = res.data;
                            }
                        })
                    }
                } else {
                    demoVue.now_page_number = parseInt($(this).text());
                    $.ajax({
                        url: 'get_demo_list',
                        data: {
                            page_number: $(this).text()
                        },
                        success: function (res) {
                            demoVue.$data.stu = res.data;
                        }
                    })
                }
            })
        })
    </script>
</head>
<body>
<div class="container-fluid" id="demo">
    <div class="row">
        <div class="col-md-6 col-md-push-3">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        测试demo
                    </h4>
                </div>
                <div class="panel-body">
                    <table class="table table-striped table-hover" role="table">
                        <!--                        展示一个人的方法-->
                        <thead>
                        <tr>
                            <th>学号</th>
                            <th>姓名</th>
                            <th>性别</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr v-for="item in stu">
                            <td>{{item.stu_no}}</td>
                            <td>{{item.name}}</td>
                            <td>{{item.sex}}</td>
                            <td>
                                <button class="btn btn-default">
                                    测试
                                </button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <div class="text-center" id="list">
                        <ul v-if="now_page_number <= 3 && now_page_number < max_page_number-1" class="pagination">
                            <li :class="havePrevious"><a>&laquo;</a></li>
                            <li :class="{'active': now_page_number == 1}"><a>1</a></li>
                            <li :class="{'active': now_page_number == 2}"><a>2</a></li>
                            <li :class="{'active': now_page_number == 3}"><a>3</a></li>
                            <li><a>...</a></li>
                            <li><a>{{max_page_number-1}}</a></li>
                            <li><a>{{max_page_number}}</a></li>
                            <li :class="haveNext"><a>&raquo;</a></li>
                        </ul>
                        <ul v-else-if="now_page_number > 3 && now_page_number+1 <= max_page_number-2" class="pagination">
                            <li :class="havePrevious"><a>&laquo;</a></li>
                            <li><a>1</a></li>
                            <li><a>2</a></li>
                            <li><a>...</a></li>
                            <li><a>{{now_page_number-1}}</a></li>
                            <li class="active"><a>{{now_page_number}}</a></li>
                            <li><a>{{now_page_number+1}}</a></li>
                            <li><a>...</a></li>
                            <li><a>{{max_page_number-1}}</a></li>
                            <li><a>{{max_page_number}}</a></li>
                            <li :class="haveNext"><a>&raquo;</a></li>
                        </ul>
                        <ul v-else-if="now_page_number>=4 && now_page_number >= max_page_number-2" class="pagination">
                            <li :class="havePrevious"><a>&laquo;</a></li>
                            <li><a>1</a></li>
                            <li><a>2</a></li>
                            <li><a>...</a></li>
                            <li :class="{'active' : now_page_number == max_page_number-2 }"><a>{{max_page_number-2}}</a></li>
                            <li :class="{'active' : now_page_number == max_page_number-1 }"><a>{{max_page_number-1}}</a></li>
                            <li :class="{'active' : now_page_number == max_page_number }"><a>{{max_page_number}}</a></li>
                            <li :class="haveNext"><a>&raquo;</a></li>
                        </ul>
                    </div>
                </div>
                <div class="panel-footer">

                </div>
            </div>
        </div>
    </div>
</div>
<script th:inline="javascript">
    // vue代码部分
    // el表示作用域哪个元素内，#表示通过id查找，.表示类查找
    // data表示放在这个元素内的数据，这和小程序类似
    // 还有别的许多方法，这里用不上
    $.ajaxSetup({
        dataType: "json"
    })
    const demoVue = new Vue({
        el: "#demo",
        data: {
            stu: [[${peoples}]],//获取后台model传来的值
            isList: false,
            now_page_number: 1,
            max_page_number: 10
        },
        created: function () {
            $.ajax({
                url: 'get_demo_list',
                data: {
                    page_number: 1
                },
                success: function (res) {
                    //成功之后将demoVue对象里的$data里的stu值改变
                    //然后vue自动去渲染网页
                    console.log(res);
                    demoVue.$data.stu = res.data;
                    demoVue.$data.max_page_number = res.max;
                }
            });

        },
        computed: {
            havePrevious: function () {
                return {
                    disabled: this.now_page_number === 1
                }
            },
            haveNext: function () {
                return {
                    disabled: this.now_page_number === this.max_page_number
                }
            },
            onePageUrl: function () {

            },
            allPageUrl: function () {

            }
        }
    });

</script>
</body>
</html>